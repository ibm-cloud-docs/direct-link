---

copyright:
  years: 2017, 2018
lastupdated: "2018-07-25"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:download: .download}

# IBM Cloud 上的虚拟路由和转发 (VRF) 概述

根据定义，虚拟路由和转发 (VRF) 是因特网协议 (IP) 网络路由器中包含的一项技术。该技术作为固有主干服务交付。

## IBM Cloud 的连接选项

**分散的云资源**是位于多个位置或者甚至位于多个子网或 VLAN 的资源。这些资源需要路由功能来相互通信，即使在专用网络上下文中也是如此。此文档描述“多重隔离”租户通信选项，通常称为_客户 VRF_。它在全局 IBM Cloud 主干中实施为 MPLS 第 3 层 VPN (RFC 4364)。

一般而言，IBM Cloud 平台在我们的专用网络中提供两个路由选项，从而在 pod 和数据中心之间提供连接： 

1. **共享租赁：**一种公共逻辑网络，由使用此模型的所有租户共享，通过自动访问控制表 (ACL) 进行分隔，并支持 VLAN 生成。（本文档中未描述此选项。）

2. **多重隔离：**每个租户一个专用逻辑网络，不允许与其他租户的逻辑网络进行交互。  

本文档使用术语**客户 VRF** 来描述_多重隔离_网络连接。

## 客户 VRF 概述

虚拟路由和转发 (VRF) 允许路由表的多个实例存在于某个路由器中并同时工作。使用虚拟路由和转发 (VRF)，每个客户的 VRF 网络在其路由表内细分。此细分允许 IP 地址重叠，并且不会创建与其他客户 VRF 的任何交互，也不会干扰其他客户 VRF。IBM Cloud 利用 `10.0.0.0/8` 网络中的绝大部分，该网络可能会与客户的许多远程网络重叠。 

使用虚拟路由和转发 (VRF)，客户可使用通用表中通常不允许重叠的远程 IP 地址。IBM 仍保留了以下 RFC 1918、本地链路地址以及多点广播地址（无法使用该 VRF 服务来路由这些地址）：

* `10.0.0.0/14` 
* `10.200.0.0/14` 
* `10.198.0.0/15` 
* `169.254.0.0/16` 
* `224.0.0.0/4` 
* `166.9.0.0/16`（由专用端点服务使用）
* IBM 平台上分配给您的 VLAN 的任何 IP 范围。

IBM 正在推进新一代云部署，以在可用性专区 (AZ) 中启用虚拟私有云 (VPC)。这个新的 VPC 功能可让客户在启用了 VPC 的 AZ 中使用自带 IP (BYoIP)，这些 AZ 位于达拉斯、华盛顿特区、伦敦、法兰克福、东京和悉尼。 

主干上利用虚拟路由和转发 (VRF) 的每个租户对于每个 Direct Link 可以有一个（且仅一个）_客户 VRF_，它在租户的所有服务器之间提供连接，而无论位于何处。但是，客户可以有多个 Direct Link 帐户，这些帐户为单个交叉连接路由器提供数据。  

* 租户位于全球范围内的任何 VLAN、任何 pod 及任何数据中心的服务器可连接该租户在全球的所有其他服务器。 

* 每个租户的客户 VRF 都连接至公共的共享服务网络，从而为这些服务器提供专用可达性，以使用 DNS、共享存储器、监视以及打补丁等等。

* 客户 VRF 是在租户之间提供隔离的连接服务。租赁中所需的任何其他控件必须使用网关、安全组或基于主机的控件单独供应。

## 移动到客户 VRF 的优点

**客户 VRF 的主要优点包括：**

* 行业认可且广泛接受的_多重隔离_分隔技术。许多客户发现他们的审计员和合规管理人员更青睐 3 级 VPN 方法（相比 ACL）。   

* 由于整个 IBM 网络中添加的新站点或应用程序，客户可大幅扩展或迁移其网络可达到的范围。 

* 特定于租户的路由表会减少 IP 地址重叠的可能性，而不会产生与不适用的其他租户子网或网络其他部分重叠的风险。 

**与旧的 ACL 模型相比，客户 VRF 稍有不利：**  

* 转换为客户 VRF 需要维护时间，这会使主干流量短时间中断。

* 使用受管 VPN 服务（SSL 和 IPSec）的远程访问局限于当地数据中心；但是，共享的 ACL 主干允许从任何入口点进行全局访问。

* 无法在客户的_多重隔离_租户中进行 VLAN 生成。

## 帐户转换过程期间会发生什么

许多客户当前在 IBM Cloud 网络上的共享租户模型中操作。在转换期间，租户会转换为使用客户 VRF，最常见的是使用新的 Direct Link 预订转换，或者是按照其他方面的需要或请求。  

转换过程中涉及网络中断，此时 VLAN 及其子网会从 ACL 主干断开，然后连接至客户 VRF。此过程会导致进入或流出 VLAN 的流量短时间丢包。VLAN 内的数据包将继续流动。如果涉及网关（如 FortiGate Security Appliance 或虚拟路由器设备），那么连接至该网关的 VLAN 中不会发生中断。服务器本身不会出现网络中断，并且大部分工作负载都会在流量恢复之后自动恢复。中断的总时长取决于租户拓扑的范围，即该租户包含的子网数、VLAN 和 pod。

![转换过程](/images/vrf-on-ibm-cloud.png)

在迁移期间，客户 VLAN 会从主干断开连接，并重新连接至客户的 VRF。中断时长各有不同，具体取决于涉及的 VLAN、POD 和数据中心的数量。VLAN 中的流量会中断，但服务器保持与网络的连接。应用程序可能受影响，也可能不受影响，具体取决于其丢包敏感度。

## 如何启动转换

客户可以通过其 [IBM Cloud 控制台 ![外部链接图标](../../icons/launch-glyph.svg "外部链接图标")]( https://control.bluemix.net/support/unifiedConsole/tickets/add) 帐户开具支持凭单，以请求迁移至 VRF。
该凭单应注明“专用网络问题”，并在支持凭单中包含以下文本： 

“我们请求将帐户 _填入您的帐号_ 移动到其自己的 VRF。我们了解存在的风险并同意更改。请在回复中告知安排执行此更改的时间范围，以便我们准备进行迁移。” 

IBM Cloud 网络工程团队将完成迁移。除了约定的安排之外，客户无需提供其他信息。通常，丢包可能持续 15-30 分钟，具体取决于帐户的复杂性。（如果客户具有旧的 Direct Link 连接，那么可能会较长）。该过程已实现高度自动化。它需要 IBM 团队进行的交互极少，并且应该对客户透明。
